{% from "macros/formhelpers.html" import render_field %}

<form action="{{ url_for('admin.products') }}" method="post" enctype="multipart/form-data">
  {{ form.hidden_tag() }}
  {% if form.csrf_token.errors %}
    <ul class="alert alert-danger alert-login">
      {% for error in form.csrf_token.errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  {% endif %}
  <dl>
    {{ render_field(form.name) }}
    {{ render_field(form.description) }}
    {{ render_field(form.meta_description) }}
    {{ render_field(form.category) }}
    <div class="checkbox3 checkbox-inline checkbox-check checkbox-light">
      {{ form.has_variants(**{'data-enable':'#variants-attr', 'data-disable':'#product-attr'})|safe }}
      {{ form.has_variants.label }}
    </div>
    <div id="variants-attr" style="display:none;">
      <div data-toggle="fieldset" id="variant-fieldset">
        <button class="btn btn-default" type="button" data-toggle="fieldset-add-row" data-target="#variant-fieldset">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Adicionar variação do produto
        </button>
        <table class="table">
          <thead>
            <tr>
              <th>Cor</th>
              <th>Tamanho</th>
              <th>Preço</th>
              <th>Quantidade</th>
              <th>SKU</th>
              <th>Imagens</th>
              <th>Remover</th>
            </tr>
          </thead>
          <tbody>
            {% for variant in form.variants %}
              <tr data-toggle="fieldset-entry" data-id="{{ loop.index0 }}">
                <td>{{ variant.color()|safe }}</td>
                <td>{{ variant.size()|safe }}</td>
                <td>{{ variant.price()|safe }}</td>
                <td>{{ variant.quantity()|safe }}</td>
                <td>{{ variant.sku()|safe }}</td>
                <td>
                  {% for image_field in variant.images %}
                    {{ image_field()|safe }}
                  {% endfor %}
                </td>
                <td>
                  <button class="btn btn-default" type="button" data-toggle="fieldset-remove-row" id="variants-{{loop.index0}}-remove">
                    <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                  </button>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div id="product-attr">
      {{ render_field(form.price) }}
      {{ render_field(form.quantity) }}
      {{ render_field(form.sku) }}
      <div data-toggle="fieldset" id="image-fieldset">
        <button class="btn btn-default" type="button" data-toggle="fieldset-add-row" data-target="#image-fieldset">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Adicionar imagem
        </button>
        {% for image_field in form.images %}
          <div data-toggle="fieldset-entry" data-id="{{ loop.index0 }}">
            {{ render_field(image_field) }}
              <button class="btn btn-default" type="button" data-toggle="fieldset-remove-row" id="images-{{loop.index0}}-remove">
                <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
              </button>
          </div>
        {% endfor %}
      </div>
    </div>
  </dl>
    <p><input class="btn btn-default" id="create-category-btn" type="submit" value="Criar"></input></p>
</form>
